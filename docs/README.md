# The NativeLink documentation

This is the NativeLink documentation hosted at <https://docs.nativelink.com>.

> [!WARNING]
> Setup for working on these docs differs substantially between Linux and Mac.
>
> For Linux: Use the Nix flake and run `pnpm i`.
>
> For Mac: If you're in the Nix flake, exit it, for instance with `direnv
> revoke`. Then manually install `pnpm`, run `pnpm i` and run `pnpm exec
> playwright install`.
>
> Long term we'll add the automated setup to Mac.

## üìö Stack

The NativeLink documentation uses a custom, highly efficient, high performance
stack. Getting a bunch of bleeding-edge tools to work well together can be
challenging. Feel free to copy-paste it into your own projects.

- [Di√°taxis](https://diataxis.fr/) as overarching documentation philosophy.
- [Pnpm](https://github.com/pnpm/pnpm) as production bundler.
- [Bun](https://github.com/oven-sh/bun) as build-time TypeScript interpreter.
- [Biome](https://biomejs.dev/) as linting toolchain.
- [Astro](https://astro.build/) as meta-framework.
- [Starlight](https://starlight.astro.build/de/) as documentation framework.
- [TailwindCSS 4.0-alpha](https://tailwindcss.com/blog/tailwindcss-v4-alpha) for
  component styling which makes use of [LightningCSS](https://lightningcss.dev/)
  for faster CSS processing.
- [Cloudflare Pages/Workers](https://pages.cloudflare.com/) for deployments.

## üöÄ Common workflows

See `package.json` for build scripts.

This project requires `pnpm`. The nix flake ships a compatible version.

```bash
# Install dependencies with pnpm. Don't install with bun.
pnpm install

# Rebuild the API reference.
pnpm metaphase

# Rebuild the simple parts of the autogenerated docs.
pnpm transform

# Rebuild everything. Make sure to remove the `dist` directory beforehand.
pnpm build

# Run a development server. Doesn't rebuild the autogenerated parts of the docs.
pnpm dev

# Run formatter and linter checks.
pnpm check

# Apply formatter and linter fixes.
pnpm fix

# Test cloudflare deployments locally. Useful when debugging SSR. Rebuilds the
# autogenerated parts of the docs.
pnpm preview
```

When deploying to Cloudflare, make sure to set the `PNPM_VERSION` to `8.15.5` to
stay in sync with the flake. Also, use `pnpm exec playwright install && pnpm
build` on the Cloudflare worker. This sets up headless Chromium which is used to
generate mermaid diagrams during the build. You don't need to set playwright up
locally as it's already configured in the flake.

## üêõ Known issues

- We use Bun as internal TypeScript processor, but can't use it as bundler yet.
- `"@playform/compress": "=0.0.12"` because `0.0.13` doesn't properly compress
  CSS.
